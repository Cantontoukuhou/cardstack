<section class="cs-content-info">
  {{cs-svg "article" width="22px" height="28px"}}
  <p class="content-type">{{cs-humanize (cs-model-type model) }}</p>
  <p class="content-title">
    {{#if model.created}}
      {{moment-format model.created "YYYY-MM-DD"}}
    {{/if}}
    {{cs-model-title model}}
  </p>
</section>

<div> {{!- this one scrolls }}

  {{cs-version-control
    model=model
    enabled=editingEnabled
    on-error=(action (mut validationErrors))
  }}

  {{#each renderedFields key="id" as |fieldMark|}}
    {{#let fieldMark.model as |model|}}
      {{#cs-collapsible-section
        class=(concat "cs-toolbox-section "
          (if
            (cs-has-errors validationErrors model (hash name=model.name grouped=model.grouped))
            "invalid"))
        title=model.caption
        opened=(eq fieldMark.id openedFieldId)
        open=(action openField fieldMark)
        close=(action openField null)
        hovered=(perform highlightAndScrollToField fieldMark)
        unhovered=(perform highlightAndScrollToField null)
      }}
        <div class="cs-field-editor-section">
        {{#if model.grouped}}
          {{#each model.grouped as |fieldName|}}
            {{#with model.content as |content|}}
              <label>{{cs-field-caption content fieldName}}</label>
              {{cs-field-editor
                content=content
                field=fieldName
                enabled=editingEnabled
                canUpdate=(and
                  permissions.mayUpdateResource
                  (contains fieldName permissions.writableFields)
                )
                onchange=(action "validate")
                errors=(get validationErrors fieldName)
              }}
            {{/with}}
          {{/each}}
        {{else}}
          {{cs-field-editor
            content=model.content
            field=model.name
            enabled=editingEnabled
            canUpdate=(and
              permissions.mayUpdateResource
              (contains model.name permissions.writableFields)
            )
            onchange=(action "validate")
            errors=(get validationErrors model.name)
          }}
        {{/if}}
        </div>
      {{/cs-collapsible-section}}
    {{/let}}
  {{/each}}

  {{#each modelFields as |field|}}
    {{#cs-collapsible-section
      class=(concat "cs-toolbox-section "
        (if
          (cs-has-errors validationErrors field.model (hash name=field.name))
          "invalid"))
      title=field.options.caption
      opened=(eq field.id openedFieldId)
      open=(action openField field)
      close=(action openField null)
    }}
      <div class="cs-field-editor-section">
        {{cs-field-editor
          content=field.model
          field=field.name
          enabled=editingEnabled
          canUpdate=(and
            permissions.mayUpdateResource
            (contains field.name permissions.writableFields)
          )
          onchange=(action "validate")
          errors=(get validationErrors field.name)
        }}
      </div>
    {{/cs-collapsible-section}}
  {{/each}}


</div>
